<!-- month-entry-page.component.html -->
<div class="month-entry-page d-flex flex-column h-100">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center gap-2">
      <label class="form-label m-0">Ká»³ bÃ¡o cÃ¡o:</label>

      <select class="form-select w-auto" [ngModel]="month" (ngModelChange)="onMonthChange($event)">
        <option *ngFor="let m of months" [value]="m">
          {{ m < 10 ? '0' + m : m }}
        </option>
      </select>

      <select class="form-select w-auto" [ngModel]="year" (ngModelChange)="onYearChange($event)">
        <option *ngFor="let y of years" [value]="y">{{ y }}</option>
      </select>

      <span
        *ngIf="facade.loading$ | async"
        class="ms-2 text-primary d-flex align-items-center gap-2">
        <span class="spinner-border spinner-border-sm"></span>
        <span>Äang náº¡p thÃ¡ng {{ month }} nÄƒm {{ year }}...</span>
      </span>
    </div>

    <div class="text-end">
      <div class="fw-bold">
        ÄÆ¡n vá»‹: {{ (facade.companyName$ | async) || '' }} thÃ¡ng {{ month }} nÄƒm {{ year }} khoiId
        {{ khoiId }}
      </div>
      <!-- âœ… Tráº¡ng thÃ¡i -->
      <div *ngIf="facade.status$ | async as status" class="badge bg-primary mt-1">
        {{ status }}
      </div>
      <!-- âœ… Dirty state -->
      <!-- <div *ngIf="facade.dirty$ | async; else clean" class="small text-danger fst-italic mt-1">
        CÃ³ thay Ä‘á»•i, hÃ£y lÆ°u trÆ°á»›c khi thoÃ¡t
      </div>
      <ng-template #clean>
        <div class="small text-muted fst-italic mt-1">ChÆ°a cÃ³ thay Ä‘á»•i</div>
      </ng-template> -->
      <div class="small text-muted mb-2">      
        <span *ngIf="dirty" class="text-danger ms-2">ğŸ”¸ CÃ³ thay Ä‘á»•i, nhá»› Ctrl+S Ä‘á»ƒ lÆ°u</span>
        <span *ngIf="lastSavedTime" class="text-success ms-2">
          âœ… ÄÃ£ lÆ°u lÃºc {{ lastSavedTime | date : 'HH:mm:ss' }}
        </span>
      </div>
    </div>
  </div>

  <!-- Grid nháº­p liá»‡u -->
  <div class="flex-grow-1 overflow-auto">
    <app-month-entry-grid
      *ngIf="!(facade.loading$ | async)"
      [@fadeInOut]
      [details]="facade.details$ | async"
      [addToRelations]="facade.addToRelations$ | async"
      [editable]="facade.isEditable$ | async"
      (detailChange)="onDetailChange($event)"
      (detailChange)="markDirty()"
      (save)="onSave()"></app-month-entry-grid>
    <div *ngIf="facade.loading$ | async" class="text-center text-muted p-4" [@fadeInOut]>
      <div class="spinner-border text-primary"></div>
      <div class="mt-2">Äang náº¡p thÃ¡ng {{ month }} nÄƒm {{ year }}...</div>
    </div>
  </div>

  <!-- Footer / Actions -->
  <app-month-entry-actions
    [canSave]="facade.isEditable$ | async"
    [dirty]="facade.dirty$ | async"
    (save)="onSave()"></app-month-entry-actions>
</div>

<pre>{{ facade.isEditable$ | async }}</pre>
