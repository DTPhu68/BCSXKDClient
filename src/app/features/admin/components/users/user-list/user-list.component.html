<!-- #region Chuy·ªÉn ch·∫ø ƒë·ªô xem -->
<div class="d-flex align-items-center gap-2 mb-3">
  üîÅ Ch·∫ø ƒë·ªô xem:
  <div class="btn-group" role="group">
    <input
      type="radio"
      class="btn-check"
      name="viewMode"
      id="view-table"
      value="table"
      [(ngModel)]="viewMode"
      (change)="onViewModeChange('table')"
      checked />
    <label class="btn btn-outline-primary" for="view-table">D·∫°ng b·∫£ng</label>

    <input
      type="radio"
      class="btn-check"
      name="viewMode"
      id="view-tree"
      value="tree"
      [(ngModel)]="viewMode"
      (change)="onViewModeChange('tree')" />
    <label class="btn btn-outline-primary" for="view-tree">D·∫°ng c√¢y</label>
  </div>
</div>
<!-- #endregion -->

<!-- #region D·∫†NG B·∫¢NG -->
<ng-container *ngIf="viewMode === 'table'">
  <div class="d-flex justify-content-between mb-2">
    <div class="d-flex">
      <input
        [(ngModel)]="searchTerm"
        (input)="filter()"
        class="form-control me-2"
        style="width: 250px"
        placeholder="T√¨m theo t√™n ho·∫∑c username" />

      <select
        [(ngModel)]="statusFilter"
        (change)="filter()"
        class="form-select"
        style="width: 180px">
        <option value="all">T·∫•t c·∫£</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>

    <button class="btn btn-primary" (click)="openCreateUserModal()">Th√™m m·ªõi</button>
  </div>

  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th (click)="setSort('fullName')" class="cursor-pointer">
          H·ªç t√™n
          <i [class]="getSortIcon('fullName')"></i>
        </th>
        <th (click)="setSort('userName')" class="cursor-pointer">
          Username
          <i [class]="getSortIcon('userName')"></i>
        </th>
        <th (click)="setSort('donViName')" class="cursor-pointer">
          ƒê∆°n v·ªã
          <i [class]="getSortIcon('donViName')"></i>
        </th>
        <th (click)="setSort('roles')" class="cursor-pointer">
          Roles
          <i [class]="getSortIcon('roles')"></i>
        </th>
        <th (click)="setSort('isActive')" class="cursor-pointer">
          Tr·∫°ng th√°i
          <i [class]="getSortIcon('isActive')"></i>
        </th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of pagedUsers">
        <td>{{ u.fullName }}</td>
        <td>{{ u.userName }}</td>
        <td>{{ u.donViName }}</td>
        <td>
          <span *ngFor="let r of u.roles" class="badge bg-info me-1">{{ r }}</span>
        </td>
        <td>
          <span [class.text-success]="u.isActive" [class.text-danger]="!u.isActive">
            {{ u.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td>
          <button class="btn btn-sm btn-secondary me-1" (click)="openEditUserModal(u)">
            <i class="fas fa-edit"></i>
            S·ª≠a
          </button>
          <button class="btn btn-sm btn-warning me-1" (click)="toggleActive(u)">
            {{ u.isActive ? 'Deactive' : 'Active' }}
          </button>
          <button *ngIf="!u.isActive" class="btn btn-sm btn-danger" (click)="deleteUser(u)">
            X√≥a
          </button>
          <button class="btn btn-sm btn-info me-1" (click)="resetPassword(u)">Reset PW</button>
        </td>
      </tr>
    </tbody>
  </table>

  <pagination
    [totalItems]="filteredUsers.length"
    [(ngModel)]="currentPage"
    [itemsPerPage]="itemsPerPage"
    (pageChanged)="setPage($event.page)"
    previousText="‚Äπ"
    nextText="‚Ä∫"
    boundaryLinks="true"></pagination>
</ng-container>

<!-- #region VIEW MODE: TREE -->
<ng-container *ngIf="viewMode === 'tree'">
  <div class="row">
    <!-- Theo ƒë∆°n v·ªã -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header fw-bold">Theo ƒë∆°n v·ªã</div>
        <div class="card-body overflow-y-auto" style="max-height: 600px">
          <ul>
            <li *ngFor="let unit of unitTree">
              üè¢
              <strong>{{ unit.unitName }}</strong>
              <ul>
                <li *ngFor="let u of unit.users">
                  üë§ {{ u.fullName }}
                  <small>({{ u.userName }})</small>
                  <span [class.text-success]="u.isActive" [class.text-danger]="!u.isActive">
                    ‚Ä¢ {{ u.isActive ? 'Active' : 'Inactive' }}
                  </span>
                  <ul>
                    <li *ngFor="let r of u.roles">üìå {{ r }}</li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Theo vai tr√≤ -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header fw-bold">Theo vai tr√≤</div>
        <div class="card-body overflow-y-auto" style="max-height: 600px">
          <ul>
            <li *ngFor="let role of roleTree">
              üìå
              <strong>{{ role.roleName }}</strong>
              <ul>
                <li *ngFor="let u of role.users">
                  üë§ {{ u.fullName }}
                  <small>({{ u.userName }})</small>
                  - üè¢ {{ u.donViName }}
                  <span [class.text-success]="u.isActive" [class.text-danger]="!u.isActive">
                    ‚Ä¢ {{ u.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</ng-container>
<!-- #endregion -->
